# .github/workflows/build-blog.yml
name: Build Blog Index

on:
  push:
    branches:
      - main # Trigger this workflow on pushes to the 'main' branch

jobs:
  build:
    runs-on: ubuntu-latest # Use the latest Ubuntu runner

    steps:
    - name: Checkout repository
      uses: actions/checkout@v4 # Action to check out your repository code

    - name: Download and Install Pandoc 3.7.0.2
      # Download the specific .deb package and install it using dpkg.
      run: |
        # Define the URL for the Pandoc .deb package
        PANDOC_DEB_URL="https://github.com/jgm/pandoc/releases/download/3.7.0.2/pandoc-3.7.0.2-1-amd64.deb"
        # Define the filename for the downloaded package
        PANDOC_DEB_FILE="pandoc-3.7.0.2-1-amd64.deb"

        echo "Downloading Pandoc from: $PANDOC_DEB_URL"
        # Use wget to download the .deb package. The -O flag saves it with a specified name.
        wget "$PANDOC_DEB_URL" -O "$PANDOC_DEB_FILE"

        echo "Installing Pandoc using dpkg..."
        # Install the downloaded .deb package using dpkg.
        # -i flag indicates install. sudo is required for dpkg.
        sudo dpkg -i "$PANDOC_DEB_FILE"

        echo "Verifying Pandoc installation..."
        # Verify that Pandoc is installed and its version is correct
        pandoc --version

    - name: Make build script executable
      # Ensure the shell script has execute permissions before running it.
      run: chmod +x buildIndexHtml.sh

    - name: Run build script
      # Execute the buildIndexHtml.sh script.
      # This script will generate the index.html file as per its logic.
      run: ./buildIndexHtml.sh

    - name: Commit and Push changes
      # This section is now uncommented and will commit the generated index.html back to the repository.
      run: |
        git config user.name "GitHub Actions"
        git config user.email "actions@github.com"
        git add index.html
        git commit -m "Build: Update index.html" || echo "No changes to commit"
        git push
      env:
        GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }} # Automatically provided token for pushing
