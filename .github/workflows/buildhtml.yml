# .github/workflows/build-blog.yml
name: Build Blog Index
on:
  schedule:
    - cron: '0 12 * * *'  # Run daily at noon UTC
  push:
    branches:
      - main # Still trigger on pushes to main for testing
  workflow_dispatch:  # Allow manual triggering
jobs:
  build:
    runs-on: ubuntu-latest # Use the latest Ubuntu runner
    permissions:
      contents: write
    steps:
    - name: Checkout repository
      uses: actions/checkout@v4
      with:
        ref: main
        fetch-depth: 0  # Fetch full history so we can push to other branches

    - name: Download and Install Pandoc 3.7.0.2
      run: |
        PANDOC_DEB_URL="https://github.com/jgm/pandoc/releases/download/3.7.0.2/pandoc-3.7.0.2-1-amd64.deb"
        PANDOC_DEB_FILE="pandoc-3.7.0.2-1-amd64.deb"
        echo "Downloading Pandoc from: $PANDOC_DEB_URL"
        wget "$PANDOC_DEB_URL" -O "$PANDOC_DEB_FILE"
        echo "Installing Pandoc using dpkg..."
        sudo dpkg -i "$PANDOC_DEB_FILE"
        echo "Verifying Pandoc installation..."
        pandoc --version
        echo "Removing downloaded Pandoc .deb package..."
        rm "$PANDOC_DEB_FILE"

    - name: Make build script executable
      run: chmod +x buildIndexHtml.sh

    - name: Run build script
      run: ./buildIndexHtml.sh

    - name: Commit and Push changes to publish branch
      uses: stefanzweifel/git-auto-commit-action@v5
      with:
        commit_message: Daily build - Update visible articles
        branch: publish
        create_branch: true  # Creates the publish branch if it doesn't exist yet
        skip_dirty_check: false
        push_options: '--force'

